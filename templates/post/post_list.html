{% extends 'base.html' %}
{% load static %}

{% block title %}게시물 목록{%endblock %}

{% block customCSS %}
<link rel="stylesheet" href="{% static 'css/include/categories.css' %}" />
<link rel="stylesheet" href="{% static 'css/include/sorts.css' %}" />
<link rel="stylesheet" href="{% static 'css/include/pie_chart.css' %}">
<link rel="stylesheet" href="{% static 'css/post/post_list.css' %}" />
{% endblock %}

{% block content %}
<div class="row">
    {% include 'include/category.html' %}
    {% include 'include/sort.html' %}
</div>

<div class="row justify-content-center p-0">
    <div class="infinite-container columns col-12 p-0 m60">
        {% for post in posts %}
        <figure id="post-{{ post.pk }}" class="infinite-item">
            {% include 'include/post.html' %}
        </figure>
        {% endfor %}
        {% if posts.has_next %}
        <a class="infinite-more-link d-none" href="?page={{ posts.next_page_number }}">더 보기</a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block customJS %}
<script src="{% static 'js/include/easy_pie_chart.js' %}"></script>
<script src="{% static 'js/include/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'js/include/infinite.min.js' %}"></script>
<script>
    function customChart() {
        $('.pro-chart').easyPieChart({
            barColor: '#41cc90',
            scaleColor: false,
            size: 80,
            animate: 1000,
            lineWidth: 8,
            onStep: function (value) {
                this.$el.find('span').text(Math.round(value));
            },
            onStop: function (value, to) {
                this.$el.find('span').text(Math.round(to));
            }
        });
        $('.con-chart').easyPieChart({
            barColor: '#FF725C',
            scaleColor: false,
            size: 80,
            animate: 1000,
            lineWidth: 8,
            onStep: function (value) {
                this.$el.find('span').text(Math.round(value));
            },
            onStop: function (value, to) {
                this.$el.find('span').text(Math.round(to));
            }
        });
    };

    customChart();

    $(window).scroll(function () {
        if ($(window).scrollTop() + $(window).height() == $(document).height()) {
            var infinite = new Waypoint.Infinite({
                element: $('.infinite-container')[0]
            });
            setTimeout(function () {
                customChart();
            }, 1000);
        }
    });
</script>
{% endblock %}